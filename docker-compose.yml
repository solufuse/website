version: '3.8'

services:
  # Service pour le backend API (FastAPI)
  api:
    # Je suppose que votre Dockerfile pour le backend se trouve dans le dossier ./backend
    # Si ce n'est pas le cas, veuillez ajuster ce chemin.
    build:
      context: ./backend
      dockerfile: Dockerfile
    # Le nom 'api' permet au service frontend de trouver ce service.
    hostname: api
    # Pas besoin d'exposer de ports à l'extérieur, car la communication
    # se fait à l'intérieur du réseau Docker via Nginx.

  # Service pour le frontend (React + Nginx)
  frontend:
    # Utilise le Dockerfile à la racine du projet
    build:
      context: .
      dockerfile: Dockerfile
    # On mappe le port 80 du conteneur au port 80 de votre machine locale
    ports:
      - "80:80"
    # Ce service dépend du service 'api' pour démarrer.
    depends_on:
      - api

# Docker va créer un réseau par défaut pour connecter ces services.
